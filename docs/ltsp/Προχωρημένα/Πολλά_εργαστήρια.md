# Πολλά εργαστήρια

Εάν σε μια σχολική μονάδα υπάρχουν πολλά εργαστήρια με LTSP clients τα οποία
να βρίσκονται όλα στο ίδιο υποδίκτυο, θα πρέπει να ακολουθήσουμε τις παρακάτω
οδηγίες για τη ρύθμιση των εξυπηρετητών. Διακρίνονται οι περιπτώσεις που
διαθέτετε μόνο έναν εξυπηρετητή LTSP για όλα τα εργαστήρια, ή πολλούς
εξυπηρετητές (έναν για κάθε εργαστήριο).

## Ένας εξυπηρετητής LTSP

Σε αυτήν την περίπτωση το μόνο πρόβλημα είναι ότι η εφαρμογή ***Επόπτης***
αναγνωρίζει όλους τους σταθμούς εργασίας όλων των εργαστηριών. Έτσι προτείνεται
να δημιουργηθούν στον Επόπτη μια ομάδα για κάθε εργαστήριο, σύμφωνα με τις
οδηγίες που βρίσκονται στο [Δημιουργία
τάξης](../../epoptes/Δημιουργία_τάξης.md).

## Πολλοί εξυπηρετητές LTSP

Εάν έχουμε δύο εργαστήρια στο ίδιο υποδίκτυο, το καθένα με το δικό του
εξυπηρετητή LTSP, τότε οι LTSP clients θα ξεκινούν τυχαία από όποιον server
απαντήσει πρώτος. Έτσι μπορεί να χρησιμοποιούνται οι λογαριασμοί χρηστών του
άλλου εργαστηρίου, και να εμφανίζονται στον λάθος Επόπτη.

Για να το αποτρέψουμε αυτό θα πρέπει να ορίσουμε ποιος client ανήκει στον κάθε
server, με βάση τη MAC address τους, ακολουθώντας την παρακάτω διαδικασία.

### Πρώτος εξυπηρετητής

Ανοίξτε μόνο τον έναν εξυπηρετητή και εκκινήστε μόνο τους σταθμούς εργασίας που
επιθυμείτε να ελέγχονται από αυτόν. Στυ συνέχεια δώστε τις παρακάτω εντολές,
για να δημιουργήσετε και να ανοίξετε τα κατάλληλα αρχεία ρυθμίσεων:

```shell
cd /etc/dnsmasq.d
sudo mkdir -p dhcp-hosts
sudo touch local.conf dhcp-hosts/lab1.csv
sudo chgrp sudo local.conf dhcp-hosts/lab1.csv
pluma local.conf dhcp-hosts/lab1.csv
```

Θα ανοίξει ο κειμενογράφος με δύο αρχεία. Στο αρχείο `local.conf` βάλτε μόνο
τις παρακάτω γραμμές:

```text title="/etc/dnsmasq.d/local.conf"
dhcp-hostsfile=/etc/dnsmasq.d/dhcp-hosts
dhcp-ignore=tag:!lab1
```

Στο αρχείο `lab1.csv` βάλτε για όλους τους σταθμούς εργασίας γραμμές με τη MAC
address, το εργαστήριο και το hostname τους. Τις MAC addresses μπορείτε να τις
δείτε από την εφαρμογή ***Επόπτης*** κάνοντας δεξί κλικ ▸ ***Πληροφορίες*** σε κάθε
σταθμό:

```text title="/etc/dnsmasq.d/dhcp-hosts/lab1.csv"
08:00:27:29:13:01,set:lab1,pc01
08:00:27:29:13:02,set:lab1,pc02
```

Τέλος, επανεκκινήστε την υπηρεσία dnsmasq με την εντολή:

```shell
sudo systemctl restart dnsmasq
```

### Δεύτερο εργαστήριο

Στον δεύτερο εξυπηρετητή μπορείτε να κάνετε ακριβώς την ίδια διαδικασία, αλλά
όπου βλέπετε `lab1` να βάλετε `lab2`. Αντίστοιχα και στα υπόλοιπα εργαστήρια
εάν έχετε πάνω από δύο.

**Εναλλακτικά**, αντί να φτιάξετε αρχείο `lab2.csv`, μπορείτε να αντιγράψετε
αυτούσιο το αρχείο `dhcp-hosts/lab1.csv`, και στο `local.conf` να βάλετε τα
παρακάτω:

```text title="dhcp-hosts.conf"
dhcp-hostsfile=/etc/dnsmasq.d/dhcp-hosts
dhcp-ignore=tag:lab1
```

Η διαφορά είναι ότι λείπει το θαυματικό πριν το lab1, το οποίο σημαίνει άρνηση.
Έτσι, αντί να αγνοεί (dhcp-ignore) τους clients που δεν (tag:!) είναι στο lab1,
τώρα αγνοεί όσους είναι στο lab1. Έτσι όλοι οι clients εκτός του lab1 θα
ξεκινούν από τον server2, είτε είναι στο δεύτερο εργαστήριο είτε οπουδήποτε
αλλού στο σχολείο.
